<div class="expenses-container">
  <div class="header">
    <h1>Expense Tracking</h1>
  </div>

  <!-- Expenses Table -->
  <div class="table-container">
    <table mat-table [dataSource]="expenses" class="expenses-table">
      <!-- Date Column -->
      <ng-container matColumnDef="date">
        <th mat-header-cell *matHeaderCellDef>Date</th>
        <td mat-cell *matCellDef="let expense">{{ formatDate(expense.date) }}</td>
      </ng-container>

      <!-- Category Column -->
      <ng-container matColumnDef="category">
        <th mat-header-cell *matHeaderCellDef>Category</th>
        <td mat-cell *matCellDef="let expense">
          <span class="category-badge">{{ expense.category }}</span>
        </td>
      </ng-container>

      <!-- Description Column -->
      <ng-container matColumnDef="description">
        <th mat-header-cell *matHeaderCellDef>Description</th>
        <td mat-cell *matCellDef="let expense">{{ expense.description }}</td>
      </ng-container>

      <!-- Amount Column -->
      <ng-container matColumnDef="amount">
        <th mat-header-cell *matHeaderCellDef>Amount</th>
        <td mat-cell *matCellDef="let expense" class="amount-cell">
          {{ formatCurrency(expense.amount) }}
        </td>
      </ng-container>

      <!-- Recurring Column -->
      <ng-container matColumnDef="recurring">
        <th mat-header-cell *matHeaderCellDef>Recurring</th>
        <td mat-cell *matCellDef="let expense">
          <mat-icon *ngIf="expense.isRecurring" color="primary">repeat</mat-icon>
          <span *ngIf="!expense.isRecurring">-</span>
        </td>
      </ng-container>

      <!-- Actions Column -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Actions</th>
        <td mat-cell *matCellDef="let expense">
          <button mat-icon-button color="primary" (click)="openEditDialog(expense)" title="Edit">
            <mat-icon>edit</mat-icon>
          </button>
          <button mat-icon-button color="warn" (click)="deleteExpense(expense.id)" title="Delete">
            <mat-icon>delete</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>

    <!-- Empty State -->
    <div *ngIf="expenses.length === 0 && !isLoading" class="empty-state">
      <mat-icon>receipt_long</mat-icon>
      <p>No expenses yet. Add your first expense to get started!</p>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-state">
      <p>Loading expenses...</p>
    </div>
  </div>

  <!-- Add/Edit Expense Form (Modal-like) -->
  <div class="form-container" *ngIf="expenseForm">
    <h2>{{ isEditMode ? 'Edit Expense' : 'Add New Expense' }}</h2>
    <form [formGroup]="expenseForm" (ngSubmit)="saveExpense()">
      <div class="form-row">
        <mat-form-field appearance="outline">
          <mat-label>Amount</mat-label>
          <input matInput type="number" formControlName="amount" step="0.01" min="0.01">
          <mat-error *ngIf="expenseForm.get('amount')?.hasError('required')">
            Amount is required
          </mat-error>
          <mat-error *ngIf="expenseForm.get('amount')?.hasError('min')">
            Amount must be greater than 0
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Category</mat-label>
          <mat-select formControlName="category">
            <mat-option *ngFor="let category of categories" [value]="category">
              {{ category }}
            </mat-option>
          </mat-select>
          <mat-error *ngIf="expenseForm.get('category')?.hasError('required')">
            Category is required
          </mat-error>
        </mat-form-field>
      </div>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Description</mat-label>
        <input matInput formControlName="description" placeholder="Enter expense description">
        <mat-error *ngIf="expenseForm.get('description')?.hasError('required')">
          Description is required
        </mat-error>
      </mat-form-field>

      <div class="form-row">
        <mat-form-field appearance="outline">
          <mat-label>Date</mat-label>
          <input matInput [matDatepicker]="picker" formControlName="date">
          <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
          <mat-error *ngIf="expenseForm.get('date')?.hasError('required')">
            Date is required
          </mat-error>
        </mat-form-field>

        <div class="checkbox-container">
          <mat-checkbox formControlName="isRecurring">Recurring Expense</mat-checkbox>
          <mat-form-field *ngIf="expenseForm.get('isRecurring')?.value" appearance="outline">
            <mat-label>Frequency</mat-label>
            <mat-select formControlName="recurringFrequency">
              <mat-option value="monthly">Monthly</mat-option>
              <mat-option value="weekly">Weekly</mat-option>
              <mat-option value="yearly">Yearly</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
      </div>

      <div class="form-actions">
        <button mat-raised-button type="submit" color="primary" [disabled]="expenseForm.invalid">
          {{ isEditMode ? 'Update Expense' : 'Add Expense' }}
        </button>
        <button mat-button type="button" (click)="expenseForm.reset()">Cancel</button>
      </div>
    </form>
  </div>
</div>

